<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Websocket live test Rig</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background-color: #eee;
            color: #333;
        }
        #log {background: antiquewhite; padding: 10px; height: 300px; overflow-y: scroll; border: 1px solid black;}
        .status-on{color: green;}
        .status-off{color: red;}
    </style>
</head>
<body>
<h1>Websocket live test Rig</h1>
<p id="status" class="status-off">Connecting...</p>
<form id="message-form">
<input type="text" id="message-input" placeholder="send cargo..." required />
    <button type="submit">Deploy msg</button>
</form>

<h3>Live Stream Logs:</h3>
<pre id="log"></pre>
</body>



<script>
    const log = document.getElementById('log');
    const statusEl = document.getElementById('status');
    const input = document.getElementById('message-input');


    //1.initiate Handshake
    const socket = new WebSocket('ws://localhost:8080');

    //we wanna prepeng the log msgs so new msgs stay on top!
    const appendLog = (label, message)=>{
        const entry = `${new Date().toLocaleTimeString()}: ${label} ${message}\n `

        log.textContent += entry;
    }

    socket.addEventListener("open", () => {
        statusEl.textContent = 'Connected: ws://localhost:8080';
        statusEl.className = 'status-on';
        appendLog('[SYSTEM]', 'Tunnel Established');
    });

    socket.addEventListener("message", (e) => {
        appendLog('[RECEIVED]', e.data);
    });

    socket.addEventListener("close", () => {
        statusEl.textContent = 'Disconnected';
        statusEl.className = 'status-off';
        appendLog('[SYSTEM]', 'Tunnel Collapsed.');
    });


    document.getElementById('message-form').addEventListener('submit', (e) => {
        e.preventDefault();//dont reload page

        if(socket.readyState !== WebSocket.OPEN){
            appendLog('[ERROR]', 'NO Active Tunnel Found!');
        }

        const msg = input.value.trim();
        socket.send(msg);
        appendLog('[SENT]', msg);
        input.value = '';
    })
</script>
</html>